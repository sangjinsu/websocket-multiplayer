# π—οΈ μ•„ν‚¤ν…μ² μ„¤κ³„ λ¬Έμ„

## π“‹ κ°μ”

μ΄ ν”„λ΅μ νΈλ” **μ„λ²„ authoritative physics** ν¨ν„΄μ„ μ‚¬μ©ν• μ‹¤μ‹κ°„ λ©€ν‹°ν”λ μ΄μ–΄ κ²μ„μ…λ‹λ‹¤. λ¨λ“  κ²μ„ λ΅μ§κ³Ό λ¬Όλ¦¬ μ—°μ‚°μ„ μ„λ²„μ—μ„ μ²λ¦¬ν•μ—¬ ν΄λΌμ΄μ–ΈνΈ κ°„ λ™κΈ°ν™” λ¬Έμ λ¥Ό ν•΄κ²°ν•©λ‹λ‹¤.

## π― μ„¤κ³„ μ›μΉ™

### 1. μ„λ²„ Authoritative Physics

- **λ¨λ“  λ¬Όλ¦¬ μ—°μ‚°μ„ μ„λ²„μ—μ„ μ²λ¦¬**
- ν΄λΌμ΄μ–ΈνΈλ” μ…λ ¥λ§ μ „μ†΅ν•κ³  κ²°κ³Ό μμ‹ 
- μΉν… λ°©μ§€ λ° μΌκ΄€λ κ²μ„ μƒνƒ λ³΄μ¥
- 60fps λ¬Όλ¦¬ tickμΌλ΅ λ¶€λ“λ¬μ΄ μ‹λ®¬λ μ΄μ…

### 2. λ¨λ“ν™” λ° κ΄€μ‹¬μ‚¬ λ¶„λ¦¬

- `models/`: λ°μ΄ν„° κµ¬μ΅° μ •μ
- `game/`: κ²μ„ λ΅μ§ λ° λ¬Όλ¦¬ μ—”μ§„
- `websocket/`: ν†µμ‹  μ²λ¦¬
- `public/`: ν΄λΌμ΄μ–ΈνΈ UI

### 3. λ™μ‹μ„± μ•μ „μ„±

- `sync.RWMutex`λ¥Ό μ‚¬μ©ν• μ¤λ λ“ μ•μ „ν• μƒνƒ κ΄€λ¦¬
- Goroutinesλ¥Ό ν†µν• λΉ„λ™κΈ° μ²λ¦¬
- WebSocket μ—°κ²°λ³„ λ…λ¦½μ μΈ ν•Έλ“¤λ§

## π”„ λ°μ΄ν„° ν”λ΅μ°

```text
ν΄λΌμ΄μ–ΈνΈ μ…λ ¥ β†’ WebSocket β†’ μ„λ²„ μ²λ¦¬ β†’ λ¬Όλ¦¬ μ—°μ‚° β†’ λΈλ΅λ“μΊμ¤νΈ β†’ ν΄λΌμ΄μ–ΈνΈ λ λ”λ§
```

### 1. ν΄λΌμ΄μ–ΈνΈ μ…λ ¥

```javascript
// WASD ν‚¤ μ…λ ¥
{
  type: "input",
  payload: { key: "w", pressed: true }
}
```

### 2. μ„λ²„ μ²λ¦¬

```go
// μ…λ ¥μ„ μ†λ„λ΅ λ³€ν™
func (g *Game) ApplyInput(playerID, key string) {
  switch key {
  case "w": p.Vy -= speed
  case "s": p.Vy += speed
  // ...
  }
}
```

### 3. λ¬Όλ¦¬ μ—°μ‚° (60fps)

```go
func (g *Game) Tick() {
  // 1. μ†λ„ μ μ© λ° λ§μ°°
  // 2. κ²½κ³„ μ²λ¦¬
  // 3. ν”λ μ΄μ–΄ κ°„ μ¶©λ
}
```

### 4. λΈλ΅λ“μΊμ¤νΈ

```go
// λ³€κ²½μ‚¬ν•­μ΄ μμ„ λ•λ§ μ „μ†΅
func (h *Handler) broadcastGameState() {
  if hasChanges {
    sendToAllClients(gameState)
  }
}
```

## π›οΈ μ»΄ν¬λ„νΈ μ•„ν‚¤ν…μ²

### Backend Components

#### 1. Main Server (`main.go`)

- **μ—­ν• **: μ• ν”λ¦¬μΌ€μ΄μ… μ§„μ…μ 
- **μ±…μ„**:
  - Fiber μ„λ²„ μ΄κΈ°ν™”
  - μ •μ  νμΌ μ„λΉ™
  - WebSocket λΌμ°ν… μ„¤μ •

#### 2. Game Engine (`internal/game/game.go`)

- **μ—­ν• **: κ²μ„ λ΅μ§ λ° λ¬Όλ¦¬ μ—”μ§„
- **μ±…μ„**:
  - ν”λ μ΄μ–΄ κ΄€λ¦¬ (μ¶”κ°€/μ κ±°/μ΅°ν)
  - λ¬Όλ¦¬ μ—°μ‚° (μ΄λ™/μ¶©λ/κ²½κ³„)
  - κ²μ„ μƒνƒ κ΄€λ¦¬

#### 3. WebSocket Handler (`internal/websocket/handler.go`)

- **μ—­ν• **: WebSocket μ—°κ²° λ° λ©”μ‹μ§€ μ²λ¦¬
- **μ±…μ„**:
  - μ—°κ²° μλ½/ν•΄μ 
  - λ©”μ‹μ§€ λΌμ°ν…
  - λΈλ΅λ“μΊμ¤ν…

#### 4. Data Models (`internal/models/`)

- **μ—­ν• **: λ°μ΄ν„° κµ¬μ΅° μ •μ
- **μ±…μ„**:
  - ν”λ μ΄μ–΄ μ •λ³΄ κµ¬μ΅°
  - λ©”μ‹μ§€ νƒ€μ… μ •μ
  - κ²μ„ μƒνƒ κµ¬μ΅°

### Frontend Components

#### 1. Game Client (`public/index.html`)

- **μ—­ν• **: κ²μ„ UI λ° ν΄λΌμ΄μ–ΈνΈ λ΅μ§
- **μ±…μ„**:
  - WebSocket μ—°κ²° κ΄€λ¦¬
  - μ‚¬μ©μ μ…λ ¥ μ²λ¦¬
  - Canvas λ λ”λ§
  - λ΅μ»¬ μƒνƒ κ΄€λ¦¬

## π”§ ν•µμ‹¬ μ•κ³ λ¦¬μ¦

### 1. λ¬Όλ¦¬ μ‹λ®¬λ μ΄μ…

#### μ†λ„ κΈ°λ° μ΄λ™

```go
// λ§¤ ν‹±λ§λ‹¤ μ†λ„λ¥Ό μ„μΉμ— μ μ©
p.X += p.Vx
p.Y += p.Vy
p.Vx *= friction  // λ§μ°° μ μ©
p.Vy *= friction
```

#### νƒ„μ„± μ¶©λ

```go
// ν”λ μ΄μ–΄ κ°„ μ¶©λ μ‹ μ†λ„ κµν™
nx, ny := dx/dist, dy/dist  // λ²•μ„  λ²΅ν„°
va := a.Vx*nx + a.Vy*ny     // μ†λ„ μ„±λ¶„
vb := b.Vx*nx + b.Vy*ny
a.Vx += (vb - va) * nx      // μ†λ„ κµν™
a.Vy += (vb - va) * ny
```

### 2. λ™μ‹μ„± μ μ–΄

#### μ½κΈ°/μ“°κΈ° λ®¤ν…μ¤

```go
type GameState struct {
    Mu      sync.RWMutex
    Players map[string]*Player
}

// μ½κΈ° μ‘μ—…
func (g *Game) GetPlayer(id string) *Player {
    g.State.Mu.RLock()
    defer g.State.Mu.RUnlock()
    return g.State.Players[id]
}

// μ“°κΈ° μ‘μ—…
func (g *Game) AddPlayer(player *Player) {
    g.State.Mu.Lock()
    defer g.State.Mu.Unlock()
    g.State.Players[player.ID] = player
}
```

### 3. ν¨μ¨μ μΈ λΈλ΅λ“μΊμ¤ν…

#### λ³€κ²½μ‚¬ν•­ κ°μ§€

```go
// μ΄μ „ μƒνƒμ™€ λΉ„κµν•μ—¬ λ³€κ²½μ‚¬ν•­μ΄ μμ„ λ•λ§ μ „μ†΅
currentState, _ := json.Marshal(players)
if string(currentState) != string(lastState) {
    broadcastToAllClients(currentState)
}
```

## π€ μ„±λ¥ μµμ ν™”

### 1. λ©”λ¨λ¦¬ μµμ ν™”

- λ¶ν•„μ”ν• λ΅κΉ… μ κ±°
- κ°μ²΄ μ¬μ‚¬μ©
- ν¨μ¨μ μΈ λ°μ΄ν„° κµ¬μ΅°

### 2. λ„¤νΈμ›ν¬ μµμ ν™”

- λ³€κ²½μ‚¬ν•­μ΄ μμ„ λ•λ§ λΈλ΅λ“μΊμ¤νΈ
- JSON μ§λ ¬ν™” μµμ ν™”
- μ••μ¶• μ „μ†΅ (ν•„μ”μ‹)

### 3. λ λ”λ§ μµμ ν™”

- Canvas κΈ°λ° ν¨μ¨μ  λ λ”λ§
- λ¶ν•„μ”ν• DOM μ΅°μ‘ μµμ†ν™”
- μ• λ‹λ©”μ΄μ… μµμ ν™”

## π”’ λ³΄μ• κ³ λ ¤μ‚¬ν•­

### 1. μ…λ ¥ κ²€μ¦

- ν΄λΌμ΄μ–ΈνΈ μ…λ ¥μ μ ν¨μ„± κ²€μ‚¬
- λΉ„μ •μƒμ μΈ κ°’ ν•„ν„°λ§

### 2. μ„λ²„ Authoritative

- λ¨λ“  κ²μ„ λ΅μ§μ„ μ„λ²„μ—μ„ μ²λ¦¬
- ν΄λΌμ΄μ–ΈνΈ μ΅°μ‘ λ°©μ§€

### 3. μ—°κ²° κ΄€λ¦¬

- μ—°κ²° μƒνƒ λ¨λ‹ν„°λ§
- λΉ„μ •μƒ μ—°κ²° μλ™ ν•΄μ 

## π“ ν™•μ¥μ„±

### 1. μν‰ ν™•μ¥

- Redisλ¥Ό ν†µν• μƒνƒ κ³µμ 
- λ΅λ“ λ°Έλ°μ„λ¥Ό ν†µν• λ¶„μ‚° μ²λ¦¬

### 2. κΈ°λ¥ ν™•μ¥

- μ±„ν… μ‹μ¤ν…
- κ²μ„ λ£Έ μ‹μ¤ν…
- μ μ μ‹μ¤ν…
- μ•„μ΄ν… μ‹μ¤ν…

### 3. μ„±λ¥ ν™•μ¥

- λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™
- μΊμ‹± μ‹μ¤ν…
- CDN ν™μ©

## π§ ν…μ¤νΈ μ „λµ

### 1. λ‹¨μ„ ν…μ¤νΈ

- κ° μ»΄ν¬λ„νΈλ³„ λ…λ¦½μ  ν…μ¤νΈ
- λ¬Όλ¦¬ μ—”μ§„ λ΅μ§ κ²€μ¦

### 2. ν†µν•© ν…μ¤νΈ

- WebSocket ν†µμ‹  ν…μ¤νΈ
- λ©€ν‹°ν”λ μ΄μ–΄ μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ

### 3. μ„±λ¥ ν…μ¤νΈ

- λ™μ‹ μ ‘μ†μ μ ν…μ¤νΈ
- λ„¤νΈμ›ν¬ μ§€μ—° μ‹λ®¬λ μ΄μ…

---

μ΄ μ•„ν‚¤ν…μ²λ” ν™•μ¥ κ°€λ¥ν•κ³  μ μ§€λ³΄μκ°€ μ©μ΄ν• λ©€ν‹°ν”λ μ΄μ–΄ κ²μ„ μ‹μ¤ν…μ„ μ κ³µν•©λ‹λ‹¤.
